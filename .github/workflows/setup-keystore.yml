name: Setup Android Keystore

on:
  workflow_dispatch:

jobs:
  generate-keystore:
    runs-on: ubuntu-latest
    steps:
      - name: Set up JDK 17
        uses: actions/setup-java@v3
        with:
          java-version: '17'
          distribution: 'temurin'

      - name: Generate and Save Secrets
        run: |
          # 1. Generate Keystore
          keytool -genkey -v -keystore my-upload-key.keystore -alias my-key-alias -keyalg RSA -keysize 2048 -validity 10000 -storepass android -keypass android -dname "CN=ListApp User, OU=ListApp, O=Personal, L=Unknown, S=Unknown, C=US"
          
          # 2. Get SHA-1
          SHA1=$(keytool -list -v -keystore my-upload-key.keystore -alias my-key-alias -storepass android | grep "SHA1:")
          
          # 3. Encode
          BASE64_KEYSTORE=$(base64 -w 0 my-upload-key.keystore)
          
          # 4. Save to secrets.txt
          echo "ANDROID_KEYSTORE_BASE64=$BASE64_KEYSTORE" >> secrets.txt
          echo "ANDROID_KEYSTORE_PASSWORD=android" >> secrets.txt
          echo "ANDROID_KEY_ALIAS=my-key-alias" >> secrets.txt
          echo "ANDROID_KEY_PASSWORD=android" >> secrets.txt
          echo "SHA-1 Fingerprint: $SHA1" >> secrets.txt

      - name: Upload Keystore and Secrets
        uses: actions/upload-artifact@v4
        with:
          name: keystore-and-secrets
          path: |
            secrets.txt
            my-upload-key.keystore
